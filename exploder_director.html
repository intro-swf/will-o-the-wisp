<!DOCTYPE html>
<html>
  <head>
    <title>Exploder: Director</title>
    <script>
      
      Object.assign(Blob.prototype, {
        readBytesAsync: function() {
          const self = this;
          return new Promise(function(resolve, reject) {
            var fr = new FileReader;
            fr.onload = function(e) {
              resolve(new Uint8Array(this.result));
            };
            fr.onerror = function(e) {
              reject(this.error);
            };
            fr.readAsArrayBuffer(self);
          });
        },
      });
      
      Object.assign(Uint8Array.prototype, {
        offset: 0,
        readByteString: function(n) {
          var str = String.fromCharCode.apply(null, this.subarray(this.offset, this.offset + n));
          this.offset += n;
          return str;
        },
      });
      
      async function explode(file) {
        var bytes = await file.readBytesAsync();
        if (bytes.readByteString(4) !== 'RIFX') {
          throw new Error('invalid header');
        }
      }
      
      window.onload = function() {
        var dropzone = document.getElementById('dropzone');
        dropzone.ondragover = function(e) {
          e.preventDefault();
        };
        dropzone.ondrop = function(e) {
          e.preventDefault();
          for (var i = 0; i < e.dataTransfer.items.length; i++) {
            if (e.dataTransfer.items[i].kind === 'file') {
              explode(e.dataTransfer.items[i].getAsFile());
              break;
            }
          }
        };
      };
      
    </script>
    <style>
      #dropzone {
        border: 5px dashed #888;
      }
      #dropzone.dropping {
        border-color: #000;
      }
    </style>
  </head>
  <body>
    <div id='dropzone'>Drop</div>
  </body>
</html>
